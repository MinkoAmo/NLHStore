<div th:fragment="editCategory" th:with="isUpdate=${model.id != null}" th:object="${model}">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>
            <!--Blank page-->
            <small><!--it all starts here--></small>
        </h1>
    </section>
    <div class="box box-primary">
        <div class="box-header with-border">
            <h3 th:text="${isUpdate} ? 'Cập nhật danh mục' : 'Thêm danh mục'"></h3>
        </div>
        <!-- /.box-header -->
        <!-- form start -->
        <form role="form" id="categoryForm">
            <div class="box-body">
                <div class="form-group">
                    <label for="code">Mã danh mục</label>
                    <input type="text" class="form-control" placeholder="Nhập vào mã danh mục" th:field="*{code}">
                </div>
                <div class="form-group">
                    <label for="name">Tên danh mục</label>
                    <input type="text" class="form-control" placeholder="Nhập vào tên danh mục" th:field="*{name}">
                </div>
                <div class="form-group">
                    <label for="description">Mô tả</label>
                    <input type="text" class="form-control" placeholder="Nhập vào mô tả" th:field="*{description}">
                </div>
            </div>
            <!-- /.box-body -->

            <div class="box-footer">
                <button th:text="${isUpdate} ? 'Cập nhật' : 'Thêm'" id="btnSubmit" class="btn btn-primary"></button>
            </div>
        </form>
    </div>
</div>

<script th:fragment="script">
    $(document).ready(function () {
        $("#btnSubmit").click(function (e) {
            e.preventDefault();
            const data = {};
            $("#categoryForm input[name], select[name], textarea[name]").each(function () {
                const name = $(this).attr("name");
                let value;
                if ($(this).is(":checkbox")) {
                    if ($(this).is(":checked")) {
                        value = $(this).val();
                        if (!data[name]) {
                            data[name] = [value];
                        } else {
                            data[name].push(value)
                        }
                    }
                } else if ($(this).is(":radio")) {
                    if ($(this).is(":checked")) {
                        data[name] = $(this).val();
                    }
                } else {
                    data[name] = $(this).val();
                }
            });

            let id = [[${model.id} != null ? ${model.id} : 'null']];
            if (id) {
                data['id'] = id;
                updateCategory(data);
            } else {
                addCategory(data);
            }

        })
    })

    function addCategory(data) {
        $.ajax({
            url: "/api/admin/category",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(data),
            dataType: "json",
            success: function (result) {
                window.location.href = "/admin/category"
            },
            error: function (err) {
                window.location.href = "/admin/category"
            }
        })
    }

    function updateCategory(data) {
        $.ajax({
            url: "/api/admin/category/" + data.id,
            type: "PUT",
            contentType: "application/json",
            data: JSON.stringify(data),
            dataType: "json",
            success: function (result) {
                window.location.href = "/admin/category"
            },
            error: function (err) {
                window.location.href = "/admin/category"
            }
        })
    }
</script>